/// <reference path="../../typings/mocha/mocha.d.ts" />
/// <reference path="../../typings/chai/chai.d.ts" />
/// <reference path="../../typings/node/node.d.ts"/>
/// <reference path="../../typings/chai-as-promised/chai-as-promised.d.ts" />

import chai = require('chai');
var chaiAsPromised = require("chai-as-promised");
chai.use(chaiAsPromised);
var expect = chai.expect;
import c = require('../helpers/futbolWisdom');
import FakeHttpClient = require('./fakes/FakeHttpClient');

describe("The Futbol Wisdom", () => {
  
  beforeEach(() => {
    this.httpClient = new FakeHttpClient();    
    
  });
  
  describe("when getting la liga standings", ()=> {

    var object = {"_links":{"self":"http://api.football-data.org/alpha/soccerseasons/358/leagueTable/?matchday=31","soccerseason":"http://api.football-data.org/alpha/soccerseasons/358"},"leagueCaption":"Primera Division 2014/15","matchday":31,"standing":[{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/81"}},"position":1,"teamName":"FC Barcelona","playedGames":31,"points":75,"goals":87,"goalsAgainst":19,"goalDifference":68},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/86"}},"position":2,"teamName":"CF Real Madrid","playedGames":31,"points":73,"goals":92,"goalsAgainst":27,"goalDifference":65},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/78"}},"position":3,"teamName":"Atlético Madrid","playedGames":31,"points":66,"goals":59,"goalsAgainst":25,"goalDifference":34},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/95"}},"position":4,"teamName":"Valencia CF","playedGames":31,"points":65,"goals":56,"goalsAgainst":23,"goalDifference":33},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/559"}},"position":5,"teamName":"Sevilla CF","playedGames":31,"points":62,"goals":57,"goalsAgainst":36,"goalDifference":21},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/94"}},"position":6,"teamName":"Villarreal CF","playedGames":31,"points":51,"goals":44,"goalsAgainst":30,"goalDifference":14},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/84"}},"position":7,"teamName":"FC Málaga","playedGames":31,"points":46,"goals":34,"goalsAgainst":35,"goalDifference":-1},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/80"}},"position":8,"teamName":"Espanyol Barcelona","playedGames":31,"points":41,"goals":37,"goalsAgainst":38,"goalDifference":-1},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/77"}},"position":9,"teamName":"Athletic Bilbao","playedGames":31,"points":40,"goals":28,"goalsAgainst":37,"goalDifference":-9},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/558"}},"position":10,"teamName":"Celta Vigo","playedGames":31,"points":39,"goals":36,"goalsAgainst":34,"goalDifference":2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/92"}},"position":11,"teamName":"Real Sociedad San Sebastián","playedGames":31,"points":38,"goals":36,"goalsAgainst":42,"goalDifference":-6},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/87"}},"position":12,"teamName":"Rayo Vallecano","playedGames":31,"points":38,"goals":36,"goalsAgainst":59,"goalDifference":-23},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/82"}},"position":13,"teamName":"FC Getafe","playedGames":31,"points":36,"goals":28,"goalsAgainst":41,"goalDifference":-13},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/278"}},"position":14,"teamName":"SD Eibar","playedGames":31,"points":31,"goals":28,"goalsAgainst":43,"goalDifference":-15},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/285"}},"position":15,"teamName":"CF Elche","playedGames":31,"points":31,"goals":26,"goalsAgainst":54,"goalDifference":-28},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/560"}},"position":16,"teamName":"Deportivo La Coruna","playedGames":31,"points":28,"goals":27,"goalsAgainst":49,"goalDifference":-22},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/267"}},"position":17,"teamName":"UD Almeria","playedGames":31,"points":28,"goals":27,"goalsAgainst":50,"goalDifference":-23},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/88"}},"position":18,"teamName":"Levante UD","playedGames":31,"points":28,"goals":28,"goalsAgainst":58,"goalDifference":-30},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/83"}},"position":19,"teamName":"Granada CF","playedGames":31,"points":24,"goals":20,"goalsAgainst":56,"goalDifference":-36},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/295"}},"position":20,"teamName":"Córdoba CF","playedGames":31,"points":19,"goals":21,"goalsAgainst":51,"goalDifference":-30}]}
    
    beforeEach(()=>{            
      var simulatedApiResponseBody = JSON.stringify(object);
      this.httpClient.setupGet("http://api.football-data.org/alpha/soccerseasons/358/leagueTable", 
                                  simulatedApiResponseBody);
      this.futbolWisdom = new c.HubotFutbolWisdom(this.httpClient.get);      
    })

    it("should return the standing for la liga", (done) => {        
        expect(this.futbolWisdom.showLeagueTable(358))
        	.to.eventually.equal(object).notify(done());
  	});    
  })

  describe("when getting premier league standings", ()=> {

    var object = {"_links":{"self":"http://api.football-data.org/alpha/soccerseasons/354/leagueTable/?matchday=32","soccerseason":"http://api.football-data.org/alpha/soccerseasons/354"},"leagueCaption":"Premier League 2014/15","matchday":32,"standing":[{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/61"}},"position":1,"teamName":"Chelsea FC","playedGames":31,"points":73,"goals":64,"goalsAgainst":26,"goalDifference":38},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/57"}},"position":2,"teamName":"FC Arsenal London","playedGames":32,"points":66,"goals":63,"goalsAgainst":32,"goalDifference":31},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/66"}},"position":3,"teamName":"Manchester United FC","playedGames":32,"points":65,"goals":59,"goalsAgainst":30,"goalDifference":29},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/65"}},"position":4,"teamName":"Manchester City FC","playedGames":32,"points":61,"goals":65,"goalsAgainst":34,"goalDifference":31},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/64"}},"position":5,"teamName":"Liverpool FC","playedGames":32,"points":57,"goals":47,"goalsAgainst":36,"goalDifference":11},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/340"}},"position":6,"teamName":"FC Southampton","playedGames":32,"points":56,"goals":44,"goalsAgainst":22,"goalDifference":22},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/73"}},"position":7,"teamName":"Tottenham Hotspur FC","playedGames":32,"points":54,"goals":50,"goalsAgainst":46,"goalDifference":4},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/72"}},"position":8,"teamName":"Swansea City","playedGames":32,"points":47,"goals":38,"goalsAgainst":40,"goalDifference":-2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/563"}},"position":9,"teamName":"West Ham United FC","playedGames":32,"points":43,"goals":42,"goalsAgainst":40,"goalDifference":2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/70"}},"position":10,"teamName":"Stoke City FC","playedGames":32,"points":43,"goals":36,"goalsAgainst":40,"goalDifference":-4},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/354"}},"position":11,"teamName":"Crystal Palace","playedGames":32,"points":42,"goals":42,"goalsAgainst":43,"goalDifference":-1},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/62"}},"position":12,"teamName":"Everton FC","playedGames":32,"points":38,"goals":40,"goalsAgainst":43,"goalDifference":-3},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/67"}},"position":13,"teamName":"Newcastle United","playedGames":32,"points":35,"goals":33,"goalsAgainst":51,"goalDifference":-18},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/74"}},"position":14,"teamName":"West Bromwich Albion","playedGames":32,"points":33,"goals":30,"goalsAgainst":46,"goalDifference":-16},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/58"}},"position":15,"teamName":"Aston Villa FC","playedGames":32,"points":31,"goals":21,"goalsAgainst":42,"goalDifference":-21},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/71"}},"position":16,"teamName":"Sunderland AFC","playedGames":32,"points":29,"goals":25,"goalsAgainst":48,"goalDifference":-23},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/322"}},"position":17,"teamName":"Hull City FC","playedGames":32,"points":28,"goals":29,"goalsAgainst":45,"goalDifference":-16},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/328"}},"position":18,"teamName":"FC Burnley","playedGames":32,"points":26,"goals":26,"goalsAgainst":50,"goalDifference":-24},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/338"}},"position":19,"teamName":"Leicester City","playedGames":31,"points":25,"goals":32,"goalsAgainst":51,"goalDifference":-19},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/69"}},"position":20,"teamName":"Queens Park Rangers","playedGames":32,"points":25,"goals":35,"goalsAgainst":56,"goalDifference":-21}]}
    
    beforeEach(()=>{            
      var simulatedApiResponseBody = JSON.stringify(object);
      this.httpClient.setupGet("http://api.football-data.org/alpha/soccerseasons/354/leagueTable", 
                                  simulatedApiResponseBody);
      this.futbolWisdom = new c.HubotFutbolWisdom(this.httpClient.get);      
    })

    it("should return the standing for the premier league", (done) => {        
        expect(this.futbolWisdom.showLeagueTable(354))
          .to.eventually.equal(object).notify(done());
    });    
  })

  describe("when getting bundesliga standings", ()=> {

    var object = {"_links":{"self":"http://api.football-data.org/alpha/soccerseasons/351/leagueTable/?matchday=29","soccerseason":"http://api.football-data.org/alpha/soccerseasons/351"},"leagueCaption":"1. Bundesliga 2014/15","matchday":29,"standing":[{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/5"}},"position":1,"teamName":"FC Bayern München","playedGames":28,"points":70,"goals":74,"goalsAgainst":13,"goalDifference":61},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/11"}},"position":2,"teamName":"VfL Wolfsburg","playedGames":28,"points":60,"goals":62,"goalsAgainst":30,"goalDifference":32},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/18"}},"position":3,"teamName":"Bor. Mönchengladbach","playedGames":28,"points":53,"goals":44,"goalsAgainst":22,"goalDifference":22},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/3"}},"position":4,"teamName":"Bayer Leverkusen","playedGames":28,"points":51,"goals":52,"goalsAgainst":31,"goalDifference":21},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/6"}},"position":5,"teamName":"FC Schalke 04","playedGames":28,"points":41,"goals":37,"goalsAgainst":31,"goalDifference":6},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/16"}},"position":6,"teamName":"FC Augsburg","playedGames":28,"points":39,"goals":34,"goalsAgainst":36,"goalDifference":-2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/2"}},"position":7,"teamName":"TSG 1899 Hoffenheim","playedGames":28,"points":37,"goals":43,"goalsAgainst":45,"goalDifference":-2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/19"}},"position":8,"teamName":"Eintracht Frankfurt","playedGames":28,"points":35,"goals":51,"goalsAgainst":57,"goalDifference":-6},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/12"}},"position":9,"teamName":"Werder Bremen","playedGames":28,"points":35,"goals":43,"goalsAgainst":57,"goalDifference":-14},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/4"}},"position":10,"teamName":"Borussia Dortmund","playedGames":28,"points":33,"goals":35,"goalsAgainst":37,"goalDifference":-2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/1"}},"position":11,"teamName":"1. FC Köln","playedGames":28,"points":33,"goals":29,"goalsAgainst":35,"goalDifference":-6},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/9"}},"position":12,"teamName":"Hertha BSC","playedGames":28,"points":33,"goals":34,"goalsAgainst":45,"goalDifference":-11},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/15"}},"position":13,"teamName":"1. FSV Mainz 05","playedGames":28,"points":31,"goals":37,"goalsAgainst":39,"goalDifference":-2},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/17"}},"position":14,"teamName":"SC Freiburg","playedGames":28,"points":29,"goals":27,"goalsAgainst":36,"goalDifference":-9},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/8"}},"position":15,"teamName":"Hannover 96","playedGames":28,"points":29,"goals":32,"goalsAgainst":45,"goalDifference":-13},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/29"}},"position":16,"teamName":"SC Paderborn 07","playedGames":28,"points":27,"goals":25,"goalsAgainst":53,"goalDifference":-28},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/10"}},"position":17,"teamName":"VfB Stuttgart","playedGames":28,"points":26,"goals":31,"goalsAgainst":51,"goalDifference":-20},{"_links":{"team":{"href":"http://api.football-data.org/alpha/teams/7"}},"position":18,"teamName":"Hamburger SV","playedGames":28,"points":25,"goals":16,"goalsAgainst":43,"goalDifference":-27}]}
    
    beforeEach(()=>{            
      var simulatedApiResponseBody = JSON.stringify(object);
      this.httpClient.setupGet("http://api.football-data.org/alpha/soccerseasons/351/leagueTable", 
                                  simulatedApiResponseBody);
      this.futbolWisdom = new c.HubotFutbolWisdom(this.httpClient.get);      
    })

    it("should return the standing for the bundesliga league", (done) => {        
        expect(this.futbolWisdom.showLeagueTable(351))
          .to.eventually.equal(object).notify(done());
    });    
  })  


});